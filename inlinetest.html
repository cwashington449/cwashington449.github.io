<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    // Osano Initialization Snippet
    (function (w, o, d) {
      w[o] =
        w[o] ||
        function () {
          w[o][d].push(arguments);
        };
      w[o][d] = w[o][d] || [];
    })(window, 'Osano', 'data');

    // ===================================================================
    // NEW LOGIC
    // ===================================================================

    // 1. Define the activation logic in a reusable function.
    // This function checks for consent and activates the script.
    function activateMarketingScripts() {
      const currentConsent = window.Osano.cm.getConsent();

      if (currentConsent && currentConsent.MARKETING === 'ACCEPT') {
        // Find any marketing scripts that are still inactive ("text/plain").
        document.querySelectorAll('script[data-osano="MARKETING"][type="text/plain"]').forEach(script => {
          script.type = 'text/javascript';
          console.log('Marketing script activated.'); // Added for easier debugging
        });
      }
    }

    // 2. Run the check when Osano is initialized.
    // This handles returning visitors who already have consent.
    window.Osano('onInitialized', activateMarketingScripts);

    // 3. Run the check AGAIN every time consent is changed.
    // This handles new visitors clicking "Accept" on the banner.
    window.Osano('onConsentChanged', activateMarketingScripts);

    // ===================================================================

    window.Osano('onCookieBlocked', cookie =>
      console.debug('Osano.js blocked cookie:', cookie)
    );

    window.Osano('userData', 'example user data');
  </script>
  
  <script src="https://cmp.osano.com/16A0CuTCdGtXx3A1C/ec63760f-40b0-4c2c-b76a-e71dda7f148e/osano.js"></script> 
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script type="text/plain" data-osano="MARKETING">
    console.log('Test')
  </script>
</body>
</html>
