<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    // Osano Initialization Snippet
    (function (w, o, d) {
      w[o] =
        w[o] ||
        function () {
          w[o][d].push(arguments);
        };
      w[o][d] = w[o][d] || [];
    })(window, 'Osano', 'data');

    // CORRECTED LOGIC
    // This function will run after the main Osano script has fully initialized.
    window.Osano('onInitialized', () => {
      console.log('Osano.js initialized');

      // Use the correct function to get the current consent status.
      const currentConsent = window.Osano.cm.getConsent();

      // First, check if the consent object exists, then check the MARKETING property.
      // This will activate the marketing script only if consent has been given.
      if (currentConsent && currentConsent.MARKETING === 'ACCEPT') {
        document.querySelectorAll('script[data-osano="MARKETING"]').forEach(script => {
          if (script.type === 'text/plain') {
            script.type = 'text/javascript';
          }
        });
      }
    });

    // This listener remains for debugging purposes.
    window.Osano('onCookieBlocked', cookie =>
      console.debug('Osano.js blocked cookie:', cookie)
    );

    // This remains for your specific Osano configuration.
    window.Osano('userData', 'example user data');
  </script>
  
  <script src="https://cmp.osano.com/16A0CuTCdGtXx3A1C/ec63760f-40b0-4c2c-b76a-e71dda7f148e/osano.js"></script> 
  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <script type="text/plain" data-osano="MARKETING">
    console.log('Test')
  </script>
</body>
</html>
